<% if (initial)  {%>
	<div class="flex-row">
		<button onclick="leaveGame()">Leave Game</button>
		<button onclick="addLocalPlayer()">Add Local Player</button>
	<script src="/static/js/lobby.js" type="module"></script>
	<div id="lobby">
<% } %>
		<h1 class="text-4xl"><%= ownerName %>'s Game</h1>
		<p>Players: <%= players.length %> / <span class="glow-red"><%= gameSettings.maxPlayers %></span></p>
		<div class="settings">
			<h2 class="text-3xl">Lobby Settings</h2>
			<div id="lobbySettings">
				<h3>Power-ups:</h3>
				<% if (gameSettings.powerupsEnabled && gameSettings.powerups.length > 0) { %>
					<% for (const powerup of gameSettings.powerups) { %>
						<div class="powerup">
							<span class="powerup-name"><%= powerup.name %></span>
							<span class="powerup-description"><%= powerup.description %></span>
						</div>
					<% } %>
				<% } else { %>
					<p>Power-ups are disabled.</p>
					<br>
				<% } %>
				<h3>Player Lives: <%= gameSettings.playerLives %></h3>
				<h3>Game Difficulty: <%= gameSettings.gameDifficulty %></h3>
				<h3>Current Map: <%= gameSettings.map.toUpperCase() %></h3>
				<h3>Game Type: <%= (gameSettings.gameType || '').toUpperCase() %></h3>
			</div>
		</div>
		<br>
		<% if (gameSettings.gameType === 'classic') { %>
		<div class="players">
			<h2 class="text-3xl">Players:</h2>
			<div id="playerList">
				<% if (!players || players.length === 0) { %>
					<p>No players joined.</p>
				<% } else { %>
					<% for (const player of players) { %>
						<div class="border-2 <%= player.joined ? 'border-green-500' : 'border-red-500' %>">
							<% if (player.playerId === 0) { %> <!-- 0 is the admin -->
								<h3 class="glow-green"><%= player.displayName || 'Unknown Player' %> (Admin)</h3>
							<% } else if (selfId && player.playerId === selfId) {%>
								<h3 class="glow-green"><%= player.displayName || 'Unknown Player' %> (You)</h3>
							<% } else if (localPlayerId && player.playerId === localPlayerId) {%>
								<h3 class="glow-green"><%= player.displayName || 'Unknown Player' %> (You as Local)</h3>
							<% } else {%>
								<h3 class="glow-green"><%= player.displayName || 'Unknown Player' %></h3>
							<% } %>
							<span class="glow-red"><%= player.playerTitle || 'Unknown Title' %></span>
							<span class="glow-blue"><%= player.joined ? "Joined" : "Not Joined" %></span>
							<% if (localPlayerId && player.playerId === localPlayerId) { %>
								<button onclick="renameLocalPlayer(<%= player.playerId %>)" class="invite-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Rename</button>
							<% } %>
						</div>
						<br>
					<% } %>
				<% } %>
			</div>
		</div>
		<% } else { %>
			<h2 class="text-3xl mb-4">Tournament Tree</h2>
			<div class="flex flex-row gap-16 justify-center items-start overflow-x-auto pb-8">
				<% for (let r = 0; r < tournamentTree.length; r++) { 
					const round = tournamentTree[r];
					const bgColor = ['bg-blue-500', 'bg-blue-700', 'bg-yellow-400', 'bg-green-400'][r] || 'bg-gray-400';
					const textColor = r === tournamentTree.length - 1 ? 'text-black' : 'text-white';
					const title = ['Quarterfinals', 'Semifinals', 'Final', 'Winner'][r] || `Round ${r + 1}`;
				%>
				<div class="flex flex-col gap-12 justify-center items-center">
					<h3 class="text-xl font-bold mb-4 <%= textColor %>"><%= title %></h3>
					<% for (const match of round) { %>
						<div class="<%= bgColor %> rounded-lg p-4 min-w-[180px] flex flex-col items-center shadow">
							<div class="font-bold <%= textColor %>"><%= match.player1?.name || 'Waiting...' %></div>
							<div class="text-xs text-gray-200 mb-2"><%= match.player1?.title || '' %></div>
							<div class="font-bold <%= textColor %>"><%= match.player2?.name || 'Waiting...' %></div>
							<div class="text-xs text-gray-200"><%= match.player2?.title || '' %></div>
							<% if (match.winner) { %>
								<div class="mt-2 px-2 py-1 text-sm rounded <%= r === tournamentTree.length - 1 ? 'bg-black text-white' : 'bg-white text-black' %>">
									Winner: <%= match.winner.name %>
								</div>
							<% } %>
						</div>
					<% } %>
				</div>
				<% } %>
			</div>
		<% } %>
<% if (initial) { %>
	</div> <!-- End of lobby div -->
</div> <!-- End of page div -->
<% } %>