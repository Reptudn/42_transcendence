<%
const rounds = tournamentTree || [];
if (Array.isArray(rounds) && rounds.length > 0) {
    const firstRoundMatches = rounds[0].length;

    // Tweak these to adjust look
    const MATCH_H = 116;      // box height (px)
    const MATCH_GAP = 18;     // vertical gap between first-round matches (px)
    const TITLE_H = 22;       // reserved vertical space for round title (px)

    const UNIT_H = MATCH_H + MATCH_GAP;                   // vertical stride per first-round match
    const TOTAL_H = firstRoundMatches * UNIT_H - MATCH_GAP; // full bracket height (excl. title)
%>
<div class="w-full overflow-x-auto pb-4 glow-green">
    <div class="flex flex-row gap-20 font-mono  min-w-max"
         style="height:<%= TITLE_H + TOTAL_H %>px;">
        <% for (let r = 0; r < rounds.length; r++) {
            const round = rounds[r];
            const titleLabels = ['Quarterfinals','Semifinals','Final','Winner'];
            const title = titleLabels[r] || `Round ${r+1}`;
            const span = 2 ** r;                 // how many first-round slots this round's match spans
            const spanHeight = span * UNIT_H;    // vertical span for one match (without title)
        %>
        <div class="relative" style="height:<%= TITLE_H + TOTAL_H %>px; min-width:250px;">
            <!-- Round title -->
            <div class="uppercase tracking-wider text-[11px] border-b border-green-700 pb-1"
                 style="height:<%= TITLE_H %>px;">
                <%= title %>
            </div>

            <!-- Matches -->
            <% for (let m = 0; m < round.length; m++) {
                const match = round[m];
                // Vertical top (after title) so later rounds center between feeders
                const topCore = (r === 0)
                    ? m * UNIT_H
                    : m * spanHeight + (spanHeight / 2) - (MATCH_H / 2);
                const top = TITLE_H + topCore;
            %>
            <div class="absolute w-[240px] border border-green-500/50 rounded px-3 py-2 backdrop-sepia hover:bg-cover hover:bg-center"
                 style="top:<%= top %>px; height:<%= MATCH_H %>px;" onmouseover="this.style.backgroundImage='url(https://i.pinimg.com/736x/e5/b9/81/e5b98110fcd62d6ebe0e636262170175.jpg)';"
     onmouseout="this.style.backgroundImage='none';">
                <pre class="m-0 text-[11px] leading-snug whitespace-pre-wrap">
P1: <span class="glow-green"><%= match.player1?.name || 'Waiting...' %></span>
    <span class="glow-green"><%= match.player1?.title || '' %></span>
P2: <span class="glow-green"><%= match.player2?.name || 'Waiting...' %></span>
    <span class="glow-green"><%= match.player2?.title || '' %></span>
WIN:<span class="<%= match.winner ? 'glow-green font-semibold ml-1' : 'glow-green ml-1' %>"><%= match.winner ? match.winner.name : 'TBD' %></span>
                </pre>
                <div class="absolute -top-2 -left-2 px-1 py-[2px] text-[9px] bg-gray-900 glow-green font-bold rounded">
                    M<%= m + 1 %>
                </div>
            </div>
            <% } %>
        </div>
        <% } %>
    </div>
</div>
<% } else { %>
<p class="font-mono text-sm text-green-300">Tournament bracket not available yet.</p>
<% } %>